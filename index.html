<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Hackathons - Hack Tracker</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon_io/site.webmanifest">
    <link rel="icon" href="/assets/favicon_io/favicon.ico">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="assets/js/sessionManager.js"></script>
    <script>
        if (!SessionManager.isAuthenticated()) {
            window.location.href = "login.html";
        }
    </script>

    <style>
        /* --- 1. FONTS & LAYOUT --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap');
        
        body { 
            margin: 0; padding: 20px; 
            background-color: #050505; 
            font-family: 'Poppins', sans-serif; 
            color: #fff; 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            min-height: 100vh; 
        }

        .container { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(0, 255, 136, 0.2); 
            padding: 40px; 
            border-radius: 20px; 
            width: 100%; max-width: 700px; 
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.1); 
        }

        h2 { 
            font-family: 'Orbitron', sans-serif; color: #00ff88; 
            text-align: center; margin-bottom: 30px; 
            text-shadow: 0 0 10px #00ff88; 
        }

        /* --- 2. FORM STYLING --- */
        form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: span 2; }
        
        label { 
            display: block; font-size: 14px; color: #00ff88; 
            margin-bottom: 8px; font-weight: 600; 
        }

        input, select { 
            background: #111; border: 1px solid #333; 
            padding: 15px; border-radius: 10px; color: #fff; 
            width: 100%; box-sizing: border-box; 
            font-family: 'Poppins', sans-serif; 
        }
        
        input:focus, select:focus { 
            border-color: #00d4ff; outline: none; 
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2); 
        }

        /* --- 3. DYNAMIC MEMBER INPUTS --- */
        .members-grid { 
            display: grid; grid-template-columns: 1fr 1fr; 
            gap: 10px; margin-top: 10px; 
        }
        .member-input { border-color: #444; background: #0a0a0a; }

        /* --- 4. BUTTONS --- */
        button { 
            background: linear-gradient(45deg, #00ff88, #00d4ff); 
            border: none; padding: 15px; font-weight: bold; 
            font-family: 'Orbitron', sans-serif; cursor: pointer; 
            border-radius: 10px; margin-top: 10px; transition: 0.3s; color: #000; 
        }
        button:hover { transform: scale(1.02); }

        .view-btn { background: transparent; border: 2px solid #00d4ff; color: #00d4ff; }
        .view-btn:hover { background: #00d4ff; color: #000; }

        .logout-btn { 
            background: #ff4444; color: white; margin-top: 20px; 
            padding: 10px 20px; font-size: 12px; border:none; 
            border-radius: 8px; cursor: pointer; 
        }

        .footer { 
            margin-top: 30px; font-size: 14px; color: #888; 
            font-family: 'Orbitron', sans-serif; 
        }
        .footer span { color: #00ff88; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h2><i class="fas fa-plus-circle"></i> ADD NEW HACKATHON</h2>
        <form id="hackForm">
            
            <div class="full-width">
                <label>Hackathon Name</label>
                <input type="text" id="name" required>
            </div>
            <div class="full-width">
                <label>Organizer Name</label>
                <input type="text" id="organizer" required>
            </div>
            
            <div>
                <label>Location</label>
                <input type="text" id="location" required>
            </div>
            <div>
                <label>Mode</label>
                <select id="mode">
                    <option value="Online"><i class="fas fa-globe"></i> Online</option>
                    <option value="Offline"><i class="fas fa-map-pin"></i> Offline</option>
                    <option value="Hybrid"><i class="fas fa-handshake"></i> Hybrid</option>
                </select>
            </div>
            
            <div>
                <label>Start Date</label>
                <input type="date" id="startDate" required>
            </div>
            <div>
                <label>End Date</label>
                <input type="date" id="endDate" required>
            </div>
            
            <div>
                <label><i class="fas fa-check"></i> Registered?</label>
                <select id="registered">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div>
                <label><i class="fas fa-chart-bar"></i> PPT Needed?</label>
                <select id="pptNeeded">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>

            <div>
                <label>Team Size (Slots)</label>
                <input type="number" id="teamSize" placeholder="e.g. 4" oninput="generateMemberInputs()" required>
            </div>
            <div>
                <label>Team Code</label>
                <input type="text" id="teamCode">
            </div>

            <div class="full-width" id="dynamic-area" style="display:none;">
                <label>Enter Member Names:</label>
                <div class="members-grid" id="members-container"></div>
            </div>
            
            <div class="full-width">
                <label>Registration Link</label>
                <input type="url" id="link" required>
            </div>
            
            <button class="full-width" type="submit"><i class="fas fa-save"></i> Save To Hack</button>
            <button class="full-width view-btn" type="button" onclick="window.location.href='dashboard.html'"><i class="fas fa-list"></i> VIEW SAVED LIST</button>
        </form>
    </div>
    
    <button onclick="logout()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> LOGOUT</button>
    <div class="footer">Made by <span>BitRise</span> <i class="fas fa-rocket"></i></div>

    <script>
        
        const API_URL = (window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost") 
            ? "http://localhost:5000/api/hackathons"
            : "https://hackathontracker.onrender.com/api/hackathons";

        // FUNCTION: Create input boxes based on team size
        function generateMemberInputs() {
            const size = document.getElementById('teamSize').value;
            const container = document.getElementById('members-container');
            const area = document.getElementById('dynamic-area');

            container.innerHTML = ""; // Clear old inputs

            if (size > 0 && size <= 10) { 
                area.style.display = "block";
                for (let i = 1; i <= size; i++) {
                    const input = document.createElement("input");
                    input.type = "text";
                    input.className = "member-input";
                    input.placeholder = `Member ${i} Name`;
                    input.id = `member-${i}`;
                    container.appendChild(input);
                }
            } else {
                area.style.display = "none";
            }
        }

        // FORM SUBMIT LOGIC
        const form = document.getElementById('hackForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect member names from dynamic inputs
            let membersArray = [];
            const size = document.getElementById('teamSize').value;
            for(let i=1; i<=size; i++) {
                const val = document.getElementById(`member-${i}`).value;
                if(val.trim() !== "") membersArray.push(val.trim());
            }
            const membersString = membersArray.join(", ");

            const btn = form.querySelector('button[type="submit"]'); 
            btn.innerText = "Saving...";
            
            const formData = {
                name: document.getElementById('name').value,
                organizer: document.getElementById('organizer').value,
                location: document.getElementById('location').value,
                mode: document.getElementById('mode').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                pptNeeded: document.getElementById('pptNeeded').value, 
                
                // Status Logic
                registered: document.getElementById('registered').value, // User Selects Yes/No
                currentStatus: "Interested", // ðŸ‘ˆ AUTO-SET TO INTERESTED (Hidden)
                
                teamSize: document.getElementById('teamSize').value,
                teamMembers: membersString,
                teamCode: document.getElementById('teamCode').value,
                link: document.getElementById('link').value
            };

            try { 
                await fetch(API_URL, { 
                    method: "POST", 
                    headers: { "Content-Type": "application/json" }, 
                    body: JSON.stringify(formData) 
                }); 
                window.location.href = "dashboard.html"; // Redirect on success
            } 
            catch (err) { 
                alert("Error saving data!"); 
                btn.innerText = "Error âŒ"; 
            }
        });

        // LOGOUT LOGIC
        function logout() { 
            SessionManager.clearSession();
            window.location.href = "login.html"; 
        }
    </script>
</body>
</html>