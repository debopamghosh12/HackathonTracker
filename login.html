<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Team Login - BitRise</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <script src="assets/js/sessionManager.js"></script>

  <style>
    :root{
      --bg:#050505;
      --glass: rgba(171, 171, 171, 0.1);
      --accent1: #00ff88;
      --accent2: #00d4ff;
      --danger: #ff4444;
      --muted: #888;
    }

    /* Page layout */
    html,body{
        height:100%;
        min-height: 100dvh;
        margin:0;
        background:var(--bg);
        font-family:'Poppins',sans-serif;
        color:#fff;
        overflow:hidden;
        overscroll-behavior: none;
    }
    .wrap{height:100%;display:flex;align-items:center;justify-content:center;padding:20px;position:relative}

    /* Particles canvas */
    #bgCanvas{position:fixed;inset:0;width:100%;height:100%;z-index:0;opacity:1;pointer-events:none}

    /* Container */
    .container{
      position:relative;
      z-index:3;
      width:360px;
      max-width:calc(100% - 40px);
      text-align:center;
      background:var(--glass);
      backdrop-filter:blur(5px);
      -webkit-backdrop-filter:blur(5px); /* Safari support */
      border-radius:20px;
      padding:40px 30px;
      border:1px solid rgba(209, 251, 231, 0.3);
      box-shadow:0 8px 32px rgba(0,0,0,0.4), inset 0 0 30px rgba(7, 22, 228, 0.08);
      transition:transform 400ms cubic-bezier(.2,.9,.3,1);
    }
    .container.enter{transform:scale(1.02)}

    h2{font-family:'Orbitron',sans-serif;color:var(--accent1);margin:0 0 8px;text-shadow:0 0 15px rgba(0,255,136,0.3);letter-spacing:2px}
    .greeting{font-size:12px;color:#bdeedd;margin-bottom:25px; letter-spacing: 1px; text-transform: uppercase; opacity: 0.8;}

    /* Input + eye */
    .field{position:relative;margin-bottom:20px}
    input[type="password"], input[type="text"]{
      width:100%;padding:14px 44px 14px 20px;border-radius:8px;background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.1);color:#fff;box-sizing:border-box;font-size:16px;text-align:center;transition:all 0.3s;
      font-family: 'Orbitron', monospace; letter-spacing: 3px;
    }
    input:focus{outline:none;border-color:var(--accent2);box-shadow:0 0 20px rgba(0,212,255,0.2); background:rgba(0,0,0,0.6);}
    
    .eye-btn{
      position:absolute;right:12px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:#666;cursor:pointer;padding:5px;font-size:12px; font-weight: bold; transition: 0.3s;
    }
    .eye-btn:hover { color: var(--accent2); }

    /* Buttons */
    .btn{
      display:inline-block;width:100%;padding:14px;border-radius:8px;border:none;font-family:'Orbitron',sans-serif;font-weight:700;cursor:pointer;font-size:14px; letter-spacing: 1px;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#000;transition:transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 0 15px rgba(0,255,136,0.2);
    }
    .btn:active{transform:scale(0.98)}
    .btn:hover{box-shadow: 0 0 25px rgba(0,255,136,0.5);}
    .btn[disabled]{opacity:0.6;cursor:not-allowed;transform:none; filter: grayscale(1);}

    /* Small links and footer */
    .links{display:flex;justify-content:space-between;align-items:center;margin-top:15px;font-size:12px}
    .back-link{color:var(--muted);text-decoration:none; transition: 0.3s;}
    .back-link:hover{color:var(--accent2); text-shadow: 0 0 5px var(--accent2);}
    .footer{font-size:11px;color:#556;border-top:1px solid rgba(255,255,255,0.05);margin-top:20px;padding-top:15px; letter-spacing: 0.5px;}

    /* Error message */
    #errorMsg{display:none;color:var(--danger);font-size:13px;margin-top:15px; font-weight: 600; text-shadow: 0 0 10px rgba(255,68,68,0.3);}

    /* Lockout style */
    .locked{border-color:rgba(255,68,68,0.4);box-shadow:0 0 30px rgba(255,68,68,0.1)}

    /* Shake animation */
    @keyframes shake {
      0%{transform:translateX(0)}
      20%{transform:translateX(-8px)}
      40%{transform:translateX(8px)}
      60%{transform:translateX(-6px)}
      80%{transform:translateX(6px)}
      100%{transform:translateX(0)}
    }
    .shake{animation:shake 400ms}

    /* Loading overlay & fake terminal */
    .overlay{
      position:absolute;inset:0;background:rgba(5,5,5,0.9);border-radius:18px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:15px;padding:20px;z-index:6;backdrop-filter: blur(5px);opacity:0;pointer-events:none;transition:opacity 220ms;
    }
    .overlay.show{opacity:1;pointer-events:auto}
    
    .spinner{width:50px;height:50px;border-radius:50%;border:3px solid transparent;border-top-color:var(--accent1); border-right-color: var(--accent2); animation:spin 800ms linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .terminal{
      width:100%;height: 140px; background:rgba(0,0,0,0.8);border-radius:6px;padding:15px;text-align:left;color:#bfeef8;font-family:'Courier New', monospace;font-size:11px;box-shadow:inset 0 0 10px rgba(0,0,0,0.8); border: 1px solid #222; overflow-y: auto;
    }
    .terminal .line{margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 3px; display: block;}
    .terminal .success{color:#00ff88}
    .terminal .info{color:#00d4ff}
    .terminal .danger{color:#ff4444}

    /* Modal (Forgot code) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:12; backdrop-filter: blur(5px);}
    .modal{background:#0c0c0c;padding:25px;border-radius:12px;width:360px;max-width:92%;border:1px solid rgba(0,255,136,0.3); box-shadow: 0 0 30px rgba(0,255,136,0.1);}
    .modal h3{margin:0 0 10px;font-family:'Orbitron',sans-serif;color:var(--accent2);font-size:18px}
    .modal p{margin:0 0 20px;color:#ccc;font-size:13px; line-height: 1.5;}
    .modal .modal-actions{display:flex;justify-content:flex-end;gap:10px}

    /* Hint */
    .hint{font-size:11px;color:#667;margin-top:5px}

    /* Responsive */
    @media (max-width:420px){
      .container{padding:25px 20px}
    }

    /* --- ANIMATION STYLES --- */
    .white-flash {
        position: fixed; inset: 0; background: rgb(0, 0, 0); z-index: 100;
        opacity: 0; pointer-events: none; transition: opacity 0.8s ease-out;
    }
    .white-flash.active { opacity: 1; }

    .glitch-mode {
        animation: glitch-anim 0.2s cubic-bezier(.25, .46, .45, .94) both infinite;
        border-color: #ff4444 !important;
        box-shadow: 0 0 30px rgba(255, 68, 68, 0.6) !important;
    }
    .glitch-mode h2 { color: #ff4444; text-shadow: 4px 0 #fff; }

    @keyframes glitch-anim {
        0% { transform: translate(0); }
        20% { transform: translate(-3px, 3px); }
        40% { transform: translate(-3px, -3px); }
        60% { transform: translate(3px, 3px); }
        80% { transform: translate(3px, -3px); }
        100% { transform: translate(0); }
    }
    /* --- SOUND BUTTON --- */
    .sound-btn {
        position: fixed; top: 20px; right: 20px; z-index: 1000;
        background: rgba(0, 0, 0, 0.6); 
        border: 1px solid #00ff88; color: #00ff88;
        padding: 8px 12px; border-radius: 4px;
        font-family: 'Orbitron', sans-serif; font-size: 10px;
        cursor: pointer; transition: 0.3s;
        backdrop-filter: blur(4px);
    }
    .sound-btn:hover {
        background: #00ff88; color: #000; box-shadow: 0 0 10px #00ff88;
    }
  </style>
</head>
<body>
  <button id="soundToggle" class="sound-btn">ðŸ”‡ MUTE</button>
  
  <audio id="bgMusic" loop>
    <source src="assets/music/opening.mp3" type="audio/mp3">
  </audio>

  <audio id="warpSound">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_0762123f9d.mp3" type="audio/mp3">
  </audio>
  <div class="white-flash" id="whiteFlash"></div>
  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <div class="wrap">
    <div class="container" id="mainContainer">
      <h2>BITRISE ACCESS</h2>
      <div class="greeting" id="greetingText">System Offline</div>

      <div class="field">
        <input id="passcode" type="password" placeholder="PASSCODE" aria-label="Secret Code" autocomplete="off">
        <button class="eye-btn" id="toggleEye" title="Show/Hide code" aria-pressed="false">SHOW</button>
      </div>

      <div style="display:flex;align-items:center;justify-content:center;margin:15px 0;gap:8px;">
        <input type="checkbox" id="rememberMe" style="width:16px;height:16px;cursor:pointer;accent-color:var(--accent1);">
        <label for="rememberMe" style="cursor:pointer;font-size:12px;color:#bdeedd;">Remember this device</label>
      </div>

      <button class="btn" id="unlockBtn">INITIALIZE</button>

      <div id="errorMsg" role="status" aria-live="polite">Access Denied.</div>

      <div class="links">
        <a href="dashboard.html" class="back-link">Guest View â†’</a>
        <a href="#" id="forgotLink" class="back-link">Lost Key?</a>
      </div>

      <div class="footer">
        SECURE GATEWAY â€¢ V2.5
        <div class="hint">Unauthorized access is logged.</div>
      </div>

      <div class="overlay" id="overlay">
        <div class="spinner" id="spinner" aria-hidden="true"></div>
        <div class="terminal" id="terminal" aria-hidden="true" style="display:none"></div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h3>RECOVERY PROTOCOL</h3>
      <p>Passcodes are encrypted locally. If lost, please contact the System Administrator on Discord or Slack to request a manual reset token.</p>
      <div class="modal-actions">
        <button id="modalClose" class="btn" style="width:auto;padding:10px 20px;font-weight:600">ACKNOWLEDGE</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
        // --- CONFIG ---
        const TARGET_HASH = "3de2c229f6e67706f418ce0850b1702bad11539f46a26d9e6d632f5ef59dd736"; 
        
        // --- DOM ELEMENTS ---
        const passInput = document.getElementById('passcode');
        const unlockBtn = document.getElementById('unlockBtn');
        const errorMsg = document.getElementById('errorMsg');
        const overlay = document.getElementById('overlay');
        const terminal = document.getElementById('terminal');
        const spinner = document.getElementById('spinner');
        const container = document.getElementById('mainContainer');
        const whiteFlash = document.getElementById('whiteFlash');
        const modalBackdrop = document.getElementById('modalBackdrop');
        const forgotLink = document.getElementById('forgotLink');
        const modalClose = document.getElementById('modalClose');
        const rememberMeCheckbox = document.getElementById('rememberMe');

        // --- THREE.JS VARIABLES (Global rakha bhalo) ---
        let scene, camera, renderer, starGeo, stars;
        let warpActive = false;
        let velocity = 0; // Idle speed
        let mouseX = 0, mouseY = 0; // Mouse interactivity variables

        // 1. DESKTOP MOUSE INTERACTION
    document.addEventListener('mousemove', (e) => {
        mouseX = (e.clientX - window.innerWidth / 2) * 0.0005;
        mouseY = (e.clientY - window.innerHeight / 2) * 0.0005;
    });

    // 2. MOBILE GYROSCOPE INTERACTION (New Feature ðŸ”¥)
    window.addEventListener('deviceorientation', (event) => {
        // Gamma: Left to Right tilt (-90 to 90)
        // Beta: Front to Back tilt (-180 to 180)
        
        let tiltX = event.gamma; 
        let tiltY = event.beta; 

        // Jodi sensor data thake (Mobile e)
        if (tiltX !== null && tiltY !== null) {
            // Speed control korar jonno 0.001 diye gun korchi
            // Mouse er moto 'mouseX' aar 'mouseY' update hobe
            mouseX = tiltX * 0.001; 
            mouseY = tiltY * 0.001;
        }
    });

        // --- MAIN 3D FUNCTION ---
        const initThreeJS = () => {
            const canvas = document.getElementById('bgCanvas');
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); 

            scene = new THREE.Scene();
            
            // Camera ke ektu pichone nilam jate "Deep" lage
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 1; 
            camera.rotation.x = Math.PI/2; 

            // --- 1. STAR COUNT BARALAM (Increase Stars) ---
            starGeo = new THREE.BufferGeometry();
            const count = 60000; // Aage 3000 chilo, ekhon 6000 korlam -> More Dense!
            
            const positions = new Float32Array(count * 3);
            const velocities = new Float32Array(count); 

            for(let i=0; i<count; i++) {
                // Tara gulo ke random position e scatter korchi
                positions[i*3] = Math.random() * 600 - 300;   // x
                positions[i*3+1] = Math.random() * 600 - 300; // y
                positions[i*3+2] = Math.random() * 600 - 300; // z
            }

            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            // Star Texture (Disk shape) -> Looks cleaner than square dots
            const sprite = new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/ball.png');
            
            const starMat = new THREE.PointsMaterial({
                color: 0x00ff88,
                size: 0.9, // Size ektu choto korlam jate clutter na lage
                map: sprite,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);

            animate();
        };

        // --- ANIMATION LOOP (Control Room) ---
        const animate = () => {
            requestAnimationFrame(animate);

            const posAttribute = starGeo.attributes.position;
            const positions = posAttribute.array;

            // --- WARP LOGIC ---
            if (warpActive) {
                // Speed baracchhi drastically
                velocity += 0.5; 
                if(velocity > 30) velocity = 30; 
                
                // STRETCH EFFECT: Warp hole tara gulo ke lomba kore di
                // Eta 'Star Wars' feel debe
                stars.scale.y = 30; 
            } else {
                velocity = 0.2; // Normal speed
                stars.scale.y = 1; // Normal shape
            }

            // --- STAR MOVEMENT ---
            for(let i=0; i<60000; i++) {
                // Tara gulo ke camera r dike aanachi (Y axis e)
                positions[i*3+1] -= velocity;

                // Tara camera cross korle, abar pichone pathiye dicchi (Loop)
                if (positions[i*3+1] < -200) {
                    positions[i*3+1] = 200; 
                    positions[i*3] = Math.random() * 600 - 300; 
                    positions[i*3+2] = Math.random() * 600 - 300; 
                }
            }
            posAttribute.needsUpdate = true;
            
            // --- 2. INTERACTIVITY LOGIC (Mouse Rotation) ---
            // Mouse move korle puro galaxy ta ektu tilt hobe
            if(!warpActive) {
                stars.rotation.y = mouseX * 0.1; 
                stars.rotation.x = -mouseY * 0.1; 
            }

            renderer.render(scene, camera);
        };

        // Init
        initThreeJS();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- AUTH & UI ---
        async function hashString(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // === SESSION ID MANAGEMENT ===
        function generateSessionId() {
            return SessionManager.generateSessionId();
        }

        function saveSession(sessionId) {
            SessionManager.saveSession(sessionId);
        }

        function validateSession() {
            return SessionManager.validateSession();
        }

        function clearSession() {
            SessionManager.clearSession();
        }

        // Check for existing valid session on page load
        window.addEventListener('load', () => {
            if (SessionManager.isAuthenticated()) {
                // Auto-redirect if valid session exists
                window.location.href = 'dashboard.html';
            }
        });

        const typeText = async (text, colorClass = 'info') => {
            const line = document.createElement('div');
            line.className = 'line ' + colorClass;
            terminal.appendChild(line);
            for(let char of text){
                line.textContent += char;
                await new Promise(r => setTimeout(r, 20));
                terminal.scrollTop = terminal.scrollHeight;
            }
        };

        async function handleLogin(){
            const inputVal = passInput.value.trim();
            if(!inputVal) return;

            unlockBtn.disabled = true;
            passInput.disabled = true;
            errorMsg.style.display = 'none';
            container.classList.remove('glitch-mode');

            overlay.classList.add('show');
            overlay.setAttribute('aria-hidden', 'false');
            spinner.style.display = 'block';
            terminal.style.display = 'none';

            await new Promise(r => setTimeout(r, 600));

            spinner.style.display = 'none';
            terminal.style.display = 'block';
            terminal.innerHTML = '';

            await typeText('> CONNECTING...', 'info');
            await new Promise(r => setTimeout(r, 300));
            await typeText('> VERIFYING CREDENTIALS...', 'info');
            
            const userHash = await hashString(inputVal);
            await new Promise(r => setTimeout(r, 500));

            if(userHash === TARGET_HASH){
                // === SUCCESS ===
                await typeText('> ACCESS GRANTED.', 'success');
                await typeText('> HYPERSPACE JUMP...', 'success');
                
                // Generate and save session if Remember Me is checked
                if (rememberMeCheckbox.checked) {
                    const sessionId = generateSessionId();
                    saveSession(sessionId);
                } else {
                    // Just set team member flag without persistent session
                    sessionStorage.setItem('sessionId', generateSessionId());
                    localStorage.setItem('isTeamMember', 'true');
                }
                
                // 1. Fade UI
                container.style.opacity = '0';
                
                // 2. Trigger Warp
                warpActive = true; 
                
                // 3. Flash after delay
                await new Promise(r => setTimeout(r, 2000));
                whiteFlash.classList.add('active');

                // 4. Redirect
                setTimeout(() => { window.location.href = 'dashboard.html'; }, 800);

                // 5. Play Sound & Trigger Warp
                if(soundEnabled) warpSound.play();
            } else {
                // === ERROR ===
                await typeText('> ACCESS DENIED.', 'danger');
                await new Promise(r => setTimeout(r, 400));
                
                overlay.classList.remove('show');
                
                unlockBtn.disabled = false;
                passInput.disabled = false;
                passInput.value = '';
                passInput.focus();
                
                container.classList.add('glitch-mode');
                errorMsg.style.display = 'block';
                errorMsg.textContent = 'Invalid Credentials.';
                
                setTimeout(() => { container.classList.remove('glitch-mode'); }, 500);
            }
        }

        unlockBtn.addEventListener('click', handleLogin);
        passInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleLogin(); });
        document.getElementById('toggleEye').addEventListener('click', (e) => {
            const isPass = passInput.type === 'password';
            passInput.type = isPass ? 'text' : 'password';
            e.target.textContent = isPass ? 'HIDE' : 'SHOW';
        });
        forgotLink.addEventListener('click', (e) => { e.preventDefault(); modalBackdrop.style.display = 'flex'; });
        modalClose.addEventListener('click', () => { modalBackdrop.style.display = 'none'; });
        modalBackdrop.addEventListener('click', (e) => { if(e.target === modalBackdrop) modalBackdrop.style.display = 'none'; });

        passInput.focus();
        setTimeout(() => container.classList.add('enter'), 100);
        // --- AUDIO SYSTEM ---
        const soundBtn = document.getElementById('soundToggle');
        const bgMusic = document.getElementById('bgMusic');
        const warpSound = document.getElementById('warpSound');
        let soundEnabled = false;

        // Volume Settings
        bgMusic.volume = 0.5; 
        warpSound.volume = 0.8;

        // Toggle Logic
        soundBtn.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            if(soundEnabled) {
                bgMusic.play().catch(() => {}); 
                soundBtn.textContent = "ðŸ”Š AUDIO ON";
                soundBtn.style.borderColor = "#00d4ff";
                soundBtn.style.color = "#00d4ff";
            } else {
                bgMusic.pause();
                soundBtn.textContent = "ðŸ”‡ MUTE";
                soundBtn.style.borderColor = "#00ff88";
                soundBtn.style.color = "#00ff88";
            }
        });

        // Auto-Enable Audio on first keypress (User Experience)
        passInput.addEventListener('keydown', () => {
            if(!soundEnabled && bgMusic.paused) {
                soundBtn.click(); // Trigger the toggle
            }
        }, { once: true });
    })();
</script>
</body>
</html>