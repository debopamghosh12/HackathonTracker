<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Hack Tracker</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon_io/site.webmanifest">
    <link rel="icon" href="/assets/favicon_io/favicon.ico">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="assets/js/sessionManager.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap');
        
        /* üëá THEME VARIABLES */
        :root {
            /* DARK MODE (Default) */
            --bg-color: #050505;
            --text-color: #fff;
            --card-bg: rgba(20, 20, 20, 0.9);
            --card-border: #333;
            --navbar-bg: rgba(0,0,0,0.6);
            --input-bg: #111;
            --primary: #00d4ff;
            --secondary: #00ff88;
            --danger: #ff4444;
            --blur: 10px;
            --shadow: 0 15px 30px rgba(0, 212, 255, 0.15);
        }

        /* ‚òÄÔ∏è LIGHT MODE OVERRIDES (Professional Look) */
        body.light-mode {
            --bg-color: #f0f2f5;      /* Soft Grey (Not bright white) */
            --text-color: #1f1f1f;    /* Dark Grey Text */
            --card-bg: #ffffff;       /* Solid White Cards */
            --card-border: #ddd;      /* Subtle Border */
            --navbar-bg: rgba(255,255,255,0.95);
            --input-bg: #f9f9f9;
            --primary: #007bff;       /* Corporate Blue */
            --secondary: #00a651;     /* Darker Green */
            --danger: #dc3545;
            --blur: 0px;              /* No Blur in Light Mode */
            --shadow: 0 4px 12px rgba(0,0,0,0.1); /* Soft Shadow */
        }

        body { 
            margin: 0; padding: 0; 
            background-color: var(--bg-color); 
            font-family: 'Poppins', sans-serif; 
            color: var(--text-color); 
            display: flex; flex-direction: column; 
            align-items: center; min-height: 100vh; 
            overflow-x: hidden; position: relative;
            transition: background 0.3s, color 0.3s;
        }

        /* Animated Canvas (Hidden in Light Mode for clarity) */
        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; 
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            transition: opacity 0.3s;
        }
        body.light-mode #bg-canvas { opacity: 0; }

        /* NAVBAR */
        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; padding: 20px 40px; box-sizing: border-box;
            background: var(--navbar-bg); backdrop-filter: blur(var(--blur));
            position: fixed; top: 0; left: 0; z-index: 100; border-bottom: 1px solid var(--card-border);
            transition: 0.3s;
        }
        .nav-left { display: flex; gap: 15px; align-items: center; }

        .nav-btn, .team-btn, .auth-btn, .theme-btn { 
            text-decoration: none; padding: 8px 16px; border-radius: 8px; 
            font-family: 'Orbitron', sans-serif; transition: 0.3s; font-size: 14px; 
            cursor: pointer; font-weight: bold; border: 1px solid; background: transparent;
        }

        .nav-btn { color: var(--secondary); border-color: var(--secondary); }
        .nav-btn:hover { background: var(--secondary); color: #000; box-shadow: 0 0 10px var(--secondary); }

        .team-btn { color: var(--primary); border-color: var(--primary); }
        .team-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 10px var(--primary); }

        .auth-btn { color: var(--danger); border-color: var(--danger); }
        .auth-btn:hover { background: var(--danger); color: white; box-shadow: 0 0 10px var(--danger); }

        /* üëá THEME TOGGLE BUTTON STYLE */
        .theme-btn { color: var(--text-color); border-color: var(--card-border); display: flex; align-items: center; justify-content: center; width: 40px; }
        .theme-btn:hover { background: var(--card-border); }

        /* HAMBURGER */
        .hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; background: none; border: none; color: var(--secondary); font-size: 24px; padding: 0; margin-right: 8px; margin-left: auto; }
        .hamburger span { width: 24px; height: 2px; background: var(--secondary); transition: 0.3s; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(8px, 8px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }

        /* MENU OVERLAY */
        .menu-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); z-index: 97; backdrop-filter: blur(4px); }
        .menu-overlay.active { display: block; }
        .side-menu { display: none; flex-direction: column; gap: 12px; position: fixed; top: 0; right: 0; height: 100vh; width: 280px; background: var(--card-bg); padding: 80px 20px 30px 20px; z-index: 98; transform: translateX(100%); transition: transform 0.4s ease; border-left: 2px solid var(--secondary); overflow-y: auto; }
        .side-menu.active { display: flex; transform: translateX(0); }
        .side-menu a { text-decoration: none; font-weight: 600; border: 1px solid; padding: 12px 16px; border-radius: 8px; font-family: 'Orbitron', sans-serif; transition: 0.3s; font-size: 14px; text-align: left; }
        .side-menu .nav-btn { color: var(--secondary); border-color: var(--secondary); }
        .side-menu .team-btn { color: var(--primary); border-color: var(--primary); }

        /* CONTENT */
        .main-content { margin-top: 100px; width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; }
        h2 { font-family: 'Orbitron', sans-serif; color: var(--primary); text-shadow: 0 0 5px var(--primary); font-size: 36px; margin-bottom: 20px; text-transform: uppercase; background: var(--navbar-bg); padding: 5px 15px; border-radius: 10px; }
        body.light-mode h2 { text-shadow: none; } /* No text shadow in light mode */

        /* ALERT */
        #reminder-container { width: 90%; max-width: 900px; margin-bottom: 20px; display: none; flex-direction: column; gap: 10px; }
        .alert-card { background: rgba(255, 68, 68, 0.1); border: 1px solid var(--danger); border-left: 5px solid var(--danger); padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .alert-text { color: var(--danger); font-size: 14px; font-weight: 600; }
        .alert-title { color: var(--danger); font-weight: bold; font-family: 'Orbitron', sans-serif; margin-right: 10px; }
        .alert-btn { background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: bold; text-decoration: none; }

        .filter-container { display: flex; gap: 10px; margin-bottom: 30px; width: 90%; max-width: 600px; }
        .search-box, .filter-select { padding: 12px; border-radius: 8px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text-color); font-family: 'Poppins', sans-serif; backdrop-filter: blur(5px); }
        .search-box { flex: 2; } .filter-select { flex: 1; cursor: pointer; }

        .list-container { width: 90%; max-width: 900px; display: grid; grid-template-columns: 1fr; gap: 25px; margin-bottom: 50px; }
        @media(min-width: 768px) { .list-container { grid-template-columns: 1fr 1fr; } }
        
        /* CARD STYLES */
        .hackathon-card { 
            background: var(--card-bg); 
            border: 1px solid var(--card-border); border-top: 5px solid; 
            padding: 30px; border-radius: 15px; transition: 0.3s; position: relative; 
            backdrop-filter: blur(var(--blur));
            box-shadow: 0 5px 10px rgba(0,0,0,0.2); /* Base Shadow */
        }
        /* Light Mode Card - Solid & Clean */
        body.light-mode .hackathon-card { box-shadow: var(--shadow); }

        .hackathon-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: var(--primary); }
        
        .status-Winner { border-top-color: #FFD700; } 
        .status-Shortlisted { border-top-color: #bc13fe; } 
        .status-Applied { border-top-color: var(--primary); } 
        .status-Interested { border-top-color: var(--secondary); } 
        .status-Rejected { border-top-color: var(--danger); opacity: 0.8; }

        .title { font-size: 22px; font-weight: 800; margin-bottom: 5px; font-family: 'Orbitron', sans-serif; }
        .organizer { font-size: 13px; color: #888; margin-bottom: 15px; display: block; }
        
        .countdown-timer { 
            font-family: 'Orbitron', sans-serif; font-size: 14px; color: #ffeb3b; 
            background: rgba(255, 235, 59, 0.1); padding: 5px 10px; 
            border-radius: 5px; display: inline-block; margin-bottom: 10px; 
            border: 1px solid rgba(255, 235, 59, 0.3); 
        }
        /* Fix Timer Color in Light Mode */
        body.light-mode .countdown-timer { color: #d4ac0d; border-color: #d4ac0d; background: rgba(255, 235, 59, 0.2); }

        .date-highlight { font-size: 14px; font-weight: bold; color: var(--text-color); opacity: 0.7; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; color: var(--text-color); opacity: 0.8; }
        
        .badge { font-size: 11px; padding: 4px 8px; border-radius: 5px; background: #222; border: 1px solid #444; color: #fff;}
        .badge.yes { border-color: var(--secondary); color: var(--secondary); } .badge.no { border-color: var(--danger); color: var(--danger); }
        .status-badge { font-size: 11px; padding: 4px 8px; border-radius: 5px; background: #333; color: #fff; border: 1px solid #555; font-weight: bold; }
        
        /* Badges Light Mode */
        body.light-mode .badge, body.light-mode .status-badge { background: #e9ecef; color: #333; border-color: #ccc; }

        .team-section { background: rgba(0,0,0,0.05); padding: 10px; border-radius: 8px; margin-top: 15px; border: 1px dashed var(--card-border); }
        .team-status { font-size: 13px; font-weight: bold; margin-bottom: 5px; display: block; }
        .status-full { color: var(--danger); } .status-open { color: var(--secondary); }
        .member-list { font-size: 12px; color: var(--text-color); font-style: italic; opacity: 0.7; }
        
        .proof-btn { background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 8px 12px; border-radius: 8px; text-decoration: none; font-size: 11px; font-family: 'Poppins'; display: inline-flex; align-items: center; gap: 5px; transition: 0.3s; }
        .proof-btn:hover { background: var(--primary); color: #fff; }
        
        .calendar-btn { background: transparent; border: 1px solid #ffeb3b; color: #ffeb3b; padding: 8px 12px; border-radius: 8px; text-decoration: none; font-size: 11px; font-family: 'Poppins'; display: inline-flex; align-items: center; gap: 5px; transition: 0.3s; }
        .calendar-btn:hover { background: #ffeb3b; color: #000; }
        /* Calendar Button Light Mode */
        body.light-mode .calendar-btn { color: #d4ac0d; border-color: #d4ac0d; }
        body.light-mode .calendar-btn:hover { background: #d4ac0d; color: #fff; }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .visit-btn { flex: 1; text-align: center; background: #333; color: #fff; padding: 10px 0; border-radius: 8px; text-decoration: none; font-weight: bold; font-family: 'Orbitron', sans-serif; font-size: 12px; border: 1px solid #555; transition: 0.3s; }
        .visit-btn:hover { background: #fff; color: #000; }
        .report-btn { background: #fff; color: #000; border: none; font-weight: 800; } 
        
        /* Light Mode Buttons */
        body.light-mode .visit-btn { background: #e2e6ea; color: #333; border-color: #dae0e5; }
        body.light-mode .visit-btn:hover { background: #333; color: #fff; }
        body.light-mode .report-btn { background: #333; color: #fff; }

        .action-btn { background: #222; color: #fff; border: 1px solid #444; padding: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 16px; }
        body.light-mode .action-btn { background: #fff; color: #333; border-color: #ccc; }
        .edit-btn:hover { background: #ffeb3b; color: #000; border-color: #ffeb3b; } 
        .delete-btn:hover { background: var(--danger); color: white; border-color: var(--danger); }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal { background: var(--card-bg); padding: 30px; border-radius: 15px; border: 1px solid var(--secondary); width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; color: var(--text-color); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal h3 { color: var(--secondary); margin-top: 0; font-family: 'Orbitron', sans-serif; }
        .modal input, .modal select { width: 100%; padding: 10px; margin-bottom: 10px; background: var(--input-bg); border: 1px solid var(--card-border); color: var(--text-color); border-radius: 5px; box-sizing: border-box; }
        .modal-actions { display: flex; gap: 10px; margin-top: 10px; }
        .save-btn { flex: 1; background: var(--secondary); border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .cancel-btn { flex: 1; background: #333; color: #fff; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        .footer { margin-top: 20px; font-size: 14px; color: #888; font-family: 'Orbitron', sans-serif; padding-bottom: 20px; }
        .footer span { color: var(--secondary); font-weight: bold; }

        /* Media Queries */
        @media (max-width: 768px) {
            .navbar { padding: 12px 15px; } .nav-left { display: none; } .hamburger { display: flex; } .filter-container { width: 95%; } .list-container { width: 95%; grid-template-columns: 1fr; }
        }
        
        /* LOADING */
        .loading-container { text-align: center; margin-top: 50px; }
        .spinner { border: 3px solid rgba(0, 255, 136, 0.2); border-top: 3px solid var(--secondary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="warp-entry-overlay"></div>
    <canvas id="bg-canvas"></canvas>

    <div class="navbar">
        <div class="nav-left">
            <a href="javascript:void(0)" onclick="goToAdd()" class="nav-btn"><i class="fas fa-plus"></i> ADD EVENT</a>
            <a href="team.html" class="team-btn"><i class="fas fa-users"></i> TEAM</a>
        </div>
        
        <div style="display:flex; align-items:center; gap: 10px;">
            <button onclick="toggleTheme()" class="theme-btn" id="themeBtn" title="Toggle Theme">‚òÄÔ∏è</button>
            
            <button onclick="logout()" class="auth-btn"><i class="fas fa-sign-out-alt"></i> LOGOUT</button>
            <button class="hamburger" id="hamburger" onclick="toggleMenu()">
                <span></span><span></span><span></span>
            </button>
        </div>
    </div>

    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
    <div class="side-menu" id="sideMenu">
        <a href="javascript:void(0)" onclick="goToAdd(); toggleMenu();" class="nav-btn"><i class="fas fa-plus"></i> ADD EVENT</a>
        <a href="team.html" onclick="toggleMenu();" class="team-btn"><i class="fas fa-users"></i> TEAM</a>
        <a href="javascript:void(0)" onclick="toggleTheme(); toggleMenu();" style="border:1px solid var(--card-border); color:var(--text-color)">üé® Switch Theme</a>
    </div>

    <div class="main-content">
        <h2><i class="fas fa-rocket"></i> UPCOMING EVENTS</h2>
        
        <div id="reminder-container"></div>

        <div class="filter-container">
            <input type="text" id="search-input" class="search-box" placeholder="üîé Search Hackathon..." oninput="filterHackathons()">
            <select id="mode-filter" class="filter-select" onchange="filterHackathons()">
                <option value="All">All Modes</option><option value="Online">Online</option><option value="Offline">Offline</option><option value="Hybrid">Hybrid</option>
            </select>
        </div>

        <div class="list-container" id="hackList">
            <div class="loading-container">
                <div class="spinner"></div>
                <div class="loading-text" style="color: var(--primary); margin-top:10px;">Loading Hackathons...</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <h3><i class="fas fa-edit"></i> EDIT DETAILS</h3>
            <input type="hidden" id="edit-id">
            <label style="font-size:12px; color:gray">Event Name</label><input type="text" id="edit-name">
            <label style="font-size:12px; color:gray">Start Date</label><input type="date" id="edit-date">
            <label style="font-size:12px; color:gray">End Date</label><input type="date" id="edit-end-date">
            <label style="font-size:12px; color:gray">Team Members</label><input type="text" id="edit-members">
            <label style="font-size:12px; color:gray"><i class="fas fa-check-square"></i> Registered?</label><select id="edit-reg"><option value="Yes">Yes</option><option value="No">No</option></select>
            <label style="font-size:12px; color:gray"><i class="fas fa-traffic-light"></i> Current Status</label>
            <select id="edit-status">
                <option value="Interested">Interested</option><option value="Applied">Applied</option><option value="Shortlisted">Shortlisted</option><option value="Rejected">Rejected</option><option value="Winner"><i class="fas fa-trophy"></i> Winner</option>
            </select>
            <label style="font-size:12px; color:var(--primary)">Certificate Link</label><input type="url" id="edit-cert" placeholder="Link">
            <label style="font-size:12px; color:var(--primary)">Photos Link</label><input type="url" id="edit-photos" placeholder="Link">
            <div class="modal-actions"><button class="save-btn" onclick="saveEdit()">SAVE</button><button class="cancel-btn" onclick="closeModal()">CANCEL</button></div>
        </div>
    </div>

    <div class="footer">Made by <span>BitRise</span> <i class="fas fa-rocket"></i></div>

    <script>
        // --- PAGE ENTRY ANIMATION ---
        window.addEventListener('load', () => {
            const overlay = document.getElementById('warp-entry-overlay');
            setTimeout(() => { overlay.style.opacity = '0'; document.body.classList.add('loaded'); }, 100);
            setTimeout(() => { overlay.remove(); }, 1300);
        });

        // --- üëá THEME TOGGLE LOGIC ---
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('themeBtn');
            body.classList.toggle('light-mode');
            
            if (body.classList.contains('light-mode')) {
                btn.innerHTML = "üåô";
                localStorage.setItem('theme', 'light');
            } else {
                btn.innerHTML = "‚òÄÔ∏è";
                localStorage.setItem('theme', 'dark');
            }
        }

        // Apply Saved Theme
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
            document.getElementById('themeBtn').innerHTML = "üåô";
        }

        function toggleMenu() {
            document.getElementById('hamburger').classList.toggle('active');
            document.getElementById('menuOverlay').classList.toggle('active');
            document.getElementById('sideMenu').classList.toggle('active');
        }

        // Close menu on escape
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { const h = document.getElementById('hamburger'); if (h.classList.contains('active')) toggleMenu(); } });

        // --- BACKGROUND ANIMATION ---
        const canvas = document.getElementById('bg-canvas'); const ctx = canvas.getContext('2d'); let width, height;
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; } window.addEventListener('resize', resize); resize();
        const particles = []; const particleCount = 50; 
        class Particle { 
            constructor() { this.reset(); } 
            reset() { this.x = Math.random() * width; this.y = Math.random() * height; this.vx = (Math.random() - 0.5) * 0.5; this.vy = (Math.random() - 0.5) * 0.5; this.size = Math.random() * 2; } 
            update() { this.x += this.vx; this.y += this.vy; if (this.x < 0 || this.x > width) this.vx *= -1; if (this.y < 0 || this.y > height) this.vy *= -1; } 
            draw() { 
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); 
                ctx.fillStyle = document.body.classList.contains('light-mode') ? '#333' : (Math.random() > 0.5 ? '#00ff88' : '#00d4ff');
                ctx.fill(); 
            } 
        }
        for (let i = 0; i < particleCount; i++) { particles.push(new Particle()); }
        function animate() { 
            ctx.clearRect(0, 0, width, height); ctx.lineWidth = 0.5; 
            for (let i = 0; i < particleCount; i++) { 
                let p1 = particles[i]; p1.update(); p1.draw(); 
                for (let j = i + 1; j < particleCount; j++) { 
                    let p2 = particles[j]; let dx = p1.x - p2.x; let dy = p1.y - p2.y; let dist = Math.sqrt(dx*dx + dy*dy); 
                    if (dist < 120) { 
                        ctx.beginPath(); 
                        ctx.strokeStyle = document.body.classList.contains('light-mode') ? `rgba(0,0,0, ${0.1 - dist/1200})` : `rgba(0, 255, 136, ${1 - dist/120})`;
                        ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke(); 
                    } 
                } 
            } 
            requestAnimationFrame(animate); 
        } 
        animate();

        // --- DASHBOARD LOGIC ---
        const API_URL = (window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost") ? "http://localhost:5000/api/hackathons" : "https://hackathontracker.onrender.com/api/hackathons";
        const listDiv = document.getElementById('hackList');
        const modal = document.getElementById('editModal');
        const isLoggedIn = SessionManager.isAuthenticated();
        const isGuest = sessionStorage.getItem('guestMode') === 'true';
        let allHackathons = [];

        //if (!isLoggedIn) { window.location.href = 'login.html'; }

        function goToAdd() { if (isLoggedIn) window.location.href = "index.html"; else window.location.href = "login.html"; }
        function logout() { SessionManager.clearSession(); try { sessionStorage.removeItem('guestMode'); } catch(e) {} window.location.href = "login.html"; }

        function triggerConfetti() {
            var duration = 3000; var animationEnd = Date.now() + duration; var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            var interval = setInterval(function() { var timeLeft = animationEnd - Date.now(); if (timeLeft <= 0) return clearInterval(interval); var particleCount = 50 * (timeLeft / duration); confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } })); confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } })); }, 250);
        }

        // GOOGLE CALENDAR
        function generateCalendarLink(name, start, end, location) {
            const s = start.replace(/-/g, '');
            const e = end.replace(/-/g, '');
            return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(name)}&dates=${s}/${e}&details=Hackathon+Event&location=${encodeURIComponent(location)}`;
        }

        // REMINDER CHECK
        function checkReminders(data) {
            const container = document.getElementById('reminder-container');
            container.innerHTML = "";
            let hasAlerts = false;
            const today = new Date();
            data.forEach(hack => {
                const eventDate = new Date(hack.startDate);
                const diffTime = eventDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays >= 0 && diffDays <= 7) {
                    hasAlerts = true;
                    container.style.display = "flex";
                    const calLink = generateCalendarLink(hack.name, hack.startDate, hack.endDate, hack.location);
                    container.innerHTML += `
                        <div class="alert-card">
                            <div>
                                <span class="alert-title"><i class="fas fa-exclamation-triangle"></i> ALERT:</span>
                                <span class="alert-text"><strong>${hack.name}</strong> starts in <strong>${diffDays} days!</strong> (${hack.startDate})</span>
                            </div>
                            <a href="${calLink}" target="_blank" class="alert-btn"><i class="fas fa-calendar-plus"></i> Remind Me</a>
                        </div>`;
                }
            });
            if(!hasAlerts) container.style.display = "none";
        }

        async function loadHackathons() {
            try {
                const res = await fetch(API_URL);
                if (!res.ok) { throw new Error(`HTTP Error: ${res.status}`); }
                let data = await res.json();
                data.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                allHackathons = data;
                checkReminders(allHackathons);
                renderList(allHackathons);
            } catch (err) {
                console.error('Error:', err);
                listDiv.innerHTML = `<div class="error-container"><i class="fas fa-exclamation-circle error-icon"></i><div class="error-text">Failed to Load</div><button class="retry-btn" onclick="loadHackathons()">Retry</button></div>`;
            }
        }

        function filterHackathons() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const mode = document.getElementById('mode-filter').value;
            const filteredData = allHackathons.filter(hack => {
                const matchesName = hack.name.toLowerCase().includes(query);
                const matchesMode = mode === "All" || hack.mode === mode;
                return matchesName && matchesMode;
            });
            renderList(filteredData);
        }

        function renderList(data) {
    listDiv.innerHTML = "";
    if (data.length === 0) { listDiv.innerHTML = "<p style='text-align:center; opacity:0.6;'>No match found.</p>"; return; }

    data.forEach(hack => {
        const pptClass = hack.pptNeeded === 'Yes' ? 'yes' : 'no';
        const regClass = hack.registered === 'Yes' ? 'yes' : 'no';
        const currentStatus = hack.currentStatus || 'Interested'; const statusClass = `status-${currentStatus}`;
        let membersList = hack.teamMembers ? hack.teamMembers.split(',').map(s => s.trim()).filter(s => s) : [];
        let vacancy = hack.teamSize - membersList.length;
        let statusText = vacancy > 0 ? `<i class="fas fa-check-circle" style="color:#00ff88"></i> ${vacancy} Slot(s) Open` : `<i class="fas fa-times-circle" style="color:#ff4444"></i> Team Full`;
        let statusColorClass = vacancy > 0 ? 'status-open' : 'status-full';

        const adminButtons = isLoggedIn ? `
            <button class="action-btn edit-btn" onclick="openEdit('${hack._id}', '${hack.name}', '${hack.startDate}', '${hack.endDate}', '${hack.registered}', '${currentStatus}', '${hack.teamMembers || ''}', '${hack.certificate || ''}', '${hack.photos || ''}')"><i class="fas fa-pencil-alt"></i></button>
            <button class="action-btn delete-btn" onclick="deleteHack('${hack._id}')"><i class="fas fa-trash-alt"></i></button>` : '';

        const certBtn = hack.certificate ? `<a href="${hack.certificate}" target="_blank" class="proof-btn"><i class="fas fa-certificate"></i> Cert</a>` : '';
        const photoBtn = hack.photos ? `<a href="${hack.photos}" target="_blank" class="proof-btn"><i class="fas fa-images"></i> Photos</a>` : '';
        const calLink = generateCalendarLink(hack.name, hack.startDate, hack.endDate, hack.location);

        // --- üëá IMPROVED TEAM CODE DESIGN ---
        let teamCodeHTML = "";
        if (isLoggedIn && hack.teamCode) {
            teamCodeHTML = `
                <div class="team-code-container" style="margin-top: 5px; display: flex; align-items: center; gap: 5px; font-size: 11px; background: rgba(0, 212, 255, 0.05); padding: 4px 8px; border-radius: 4px; width: fit-content;">
                    <i class="fas fa-key" style="color: #00d4ff;"></i> 
                    <span style="color: #aaa;">Team Code:</span>
                    <span class="secret-code" style="color: #fff; font-family: monospace; letter-spacing: 1px; cursor: pointer;" title="Click to Copy" onclick="navigator.clipboard.writeText('${hack.teamCode}'); alert('Code Copied!');">
                        ${hack.teamCode} <i class="fas fa-copy" style="font-size: 9px; margin-left: 3px; opacity: 0.7;"></i>
                    </span>
                </div>`;
        }

        const card = `
            <div class="hackathon-card ${statusClass}">
                <div class="title">${hack.name}</div>
                <div class="countdown-timer" id="timer-${hack._id}" data-start="${hack.startDate}" data-end="${hack.endDate}">Loading...</div>
                <div class="date-highlight"><i class="fas fa-calendar"></i> ${hack.startDate} <span style="font-size:12px; opacity:0.7; margin:0 5px;">to</span> ${hack.endDate}</div>
                <span class="organizer">By ${hack.organizer}</span>
                <div class="info-row"><span><i class="fas fa-map-marker-alt"></i> ${hack.location} (${hack.mode})</span></div>
                
                <div style="margin-top: 10px; display:flex; gap:5px; flex-wrap: wrap;">
                    <span class="badge ${pptClass}">PPT: ${hack.pptNeeded}</span>
                    <span class="badge ${regClass}">Reg: ${hack.registered}</span>
                    <span class="status-badge"><i class="fas fa-traffic-light"></i> ${currentStatus}</span>
                </div>

                <div class="team-section">
                    <span class="team-status ${statusColorClass}">${statusText} (${membersList.length}/${hack.teamSize})</span>
                    ${teamCodeHTML}
                    <div class="member-list" style="margin-top: 5px;">${membersList.length > 0 ? membersList.join(', ') : 'No members yet'}</div>
                </div>
                
                <div style="margin-top:10px; display:flex; gap:5px; flex-wrap:wrap;">
                    ${certBtn} ${photoBtn}
                    <a href="${calLink}" target="_blank" class="calendar-btn"><i class="fas fa-calendar-plus"></i> Remind</a>
                </div>
                
                <div class="btn-group">
                    <a href="${hack.link}" target="_blank" class="visit-btn">VISIT LINK ‚Üó</a>
                    <a href="report.html?id=${hack._id}" target="_blank" class="visit-btn report-btn"><i class="fas fa-file-alt"></i> REPORT</a>
                    ${adminButtons}
                </div>
            </div>`;
        listDiv.innerHTML += card;
    });
    startCountdown();
}
        function startCountdown() {
        setInterval(() => {
        const timers = document.querySelectorAll('.countdown-timer');
        timers.forEach(timer => {
            const startDateStr = timer.getAttribute('data-start');
            const endDateStr = timer.getAttribute('data-end');
            
            // Dates convert kora (Set time to midnight/end of day)
            const startDate = new Date(startDateStr).getTime();
            
            // End Date ke oi diner shesh (23:59:59) dhora holo
            let endDate = new Date(endDateStr);
            endDate.setHours(23, 59, 59, 999);
            endDate = endDate.getTime();

            const now = new Date().getTime();
            const distance = startDate - now;

            // üëá LOGIC: Ended vs Started vs Upcoming
            if (now > endDate) {
                // Event Shesh
                timer.innerHTML = `<i class="fas fa-flag-checkered"></i> EVENT ENDED`;
                timer.style.color = "#888"; // Grey color
                timer.style.borderColor = "#888";
                timer.style.background = "rgba(136, 136, 136, 0.1)";
            } else if (now >= startDate && now <= endDate) {
                // Event Cholche
                timer.innerHTML = `<i class="fas fa-circle-play"></i> EVENT STARTED`;
                timer.style.color = "#ff4444"; // Red color
                timer.style.borderColor = "#ff4444";
                timer.style.background = "rgba(255, 68, 68, 0.1)";
            } else {
                // Event Ashche (Countdown)
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                timer.innerHTML = `<i class="fas fa-hourglass-half" style="margin-right:5px;"></i>${days}d ${hours}h ${minutes}m ${seconds}s`;
                
                // Reset styling for countdown
                const isLight = document.body.classList.contains('light-mode');
                timer.style.color = isLight ? "#b8860b" : "#ffeb3b";
                timer.style.borderColor = isLight ? "rgba(255, 235, 59, 0.5)" : "rgba(255, 235, 59, 0.3)";
                timer.style.background = isLight ? "rgba(255, 235, 59, 0.15)" : "rgba(255, 235, 59, 0.1)";
            }
        });
    }, 1000);
}
        async function deleteHack(id) { if(!confirm("Are you sure?")) return; try { await fetch(`${API_URL}/${id}`, { method: 'DELETE' }); loadHackathons(); } catch (err) { console.error('Delete error:', err); alert('Failed to delete hackathon'); } }
        function openEdit(id, name, date, endDate, reg, status, members, cert, photos) { document.getElementById('edit-id').value = id; document.getElementById('edit-name').value = name; document.getElementById('edit-date').value = date; document.getElementById('edit-end-date').value = endDate; document.getElementById('edit-members').value = members; document.getElementById('edit-reg').value = reg; document.getElementById('edit-status').value = status; document.getElementById('edit-cert').value = cert; document.getElementById('edit-photos').value = photos; modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.style.display === 'flex') closeModal(); });
        async function saveEdit() { const id = document.getElementById('edit-id').value; const status = document.getElementById('edit-status').value; try { if (status === "Winner") triggerConfetti(); const updatedData = { name: document.getElementById('edit-name').value, startDate: document.getElementById('edit-date').value, endDate: document.getElementById('edit-end-date').value, teamMembers: document.getElementById('edit-members').value, registered: document.getElementById('edit-reg').value, currentStatus: status, certificate: document.getElementById('edit-cert').value, photos: document.getElementById('edit-photos').value }; const res = await fetch(`${API_URL}/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(updatedData) }); if (!res.ok) throw new Error('Update failed'); closeModal(); loadHackathons(); } catch (err) { console.error('Save error:', err); alert('Failed to save changes'); } }
        
        loadHackathons();
    </script>
</body>
</html>